# cs-logger
stack for uploading log archives (generated by `runai-adm collect-logs` command) and viewing log files in a centralized location

## Overview
upload `*.tar.gz` archive to minio bucket, then an automated pipeline:
- extracts archive
- organizes folders
- displays them in web-based VScode

pros:
- provides an easy to browse interface
- logs are displayed neatly
- enables quick search within files
- allows sharing with other team members

## Operation
if the cs-logger stack already installed on cluster, run this to expose minio and Grafana locally:
```
bash fast_operation.sh
```

### Upload log archives
1. enter minio UI: [http://localhost:9001/](http://localhost:9001/) (creds are in values/secret)
2. choose the "**new-log-archives**" bucket
3. upload the `tar.gz` file

### Display logs
1. enter VScode: [http://localhost:8080/](http://localhost:8080/) (password is `admin`)
2. select "**Files**" tab on the left panel, then choose the folder with the name of the log archive you uploaded.

### tmux cheatsheet
- **list running sessions**: `tmux ls`
- **attach to a running session**: `tmux a -t SESSION_NAME`
- **detach from session**: press `CTRL`+`B`, then press `D`
- **terminate running session**: `tmux kill-ses -t SESSION_NAME`

## Install

run this to deploy cs-logger stack in an empty cluster:
```
bash fast_deployment.sh
```

stack includes:
- **NFS Provisioner**: Enables using an RWX storage class
- **minio**: S3 compatible object storage, provides a simple file upload interface
- **Log archive handler**: automation script for handling log archives files
- **VScode**: web-based version of VScode, for displaying log files

## Future improvements
- have the customers send the log files directly to the object storage
(eliminating the need to send attach the file to salesforce ticket, and us downloading it)
- (requires RnD approval/participation) send log files to the object storage, **directly** from the `runai-adm` CLI tool
